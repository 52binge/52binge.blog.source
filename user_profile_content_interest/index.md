---
title: 用户内容兴趣挖掘文档
date: 2018-03-05 16:46:48
---

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX"],
    tex2jax: {
      inlineMath: [ ['$','$'], ['\\(','\\)'] ],
      displayMath: [ ['$$','$$']],
      processEscapes: true
    }
  });
</script>
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML,http://myserver.com/MathJax/config/local/local.js">
</script>

## 1. 需求

用户兴趣挖掘系统，基于用户在新浪网及博客上的访问历史，通过对日志及网页的分析，推测并记录用户的兴趣。 

### 1.1 系统流程图

![][img1]

## 2. 数据源 & 规范化

### 2.1 数据源

数据源 来自 上游 信息系统部提供的 suda log hive表，分别记录了新浪网的网页信息，blog 等博客信息. blog的文章正文需要用 crawler 爬虫模块抓取.

### 2.2 规范化

规范化一些垃圾网页，去掉一些正文长度小于 200 字的网页。

## 3. 特征计算


One : 对于每个要推荐的内容,我们需要建立一份资料 :

> 比如词 $k\_i$ 在文档 $d\_j$ 中的权重 $w\_{ij}$ (常用的方法比如 TF-IDF)> 有一个词表 Item [$w\_1$, $w\_2$, ... ,$w\_{4000}$], 对每个 document 建立一个词表 vector。Two : 需要对用户也建立一份资料 :> 比如说定义一个权重向量 ($w\_{c1},...,w\_{ck}$) , 其中 $w\_{ci}$ 表示第 $k\_i$ 个词对用户 $c$ 的重要度
> user 之前有看过的 小说 或 文档。(看过的文档放在一起搞一个doc_vector，或者 将 doc_vector 加权平均)

Three : 计算匹配度 

> 余弦距离公式

$$
u(c, s) = \cos(\vec{w\_c}, \vec{w\_s}) = \frac{\vec{w_c} \cdot \vec{w\_s}}{\vec{||w\_c||} \times \vec{||w\_s||}}
$$

> 总结三步 :
> 
> 1. 对 每个 document 建立 vector
> 2. 对 每个 user 建立 vector
> 3. 比对 user 向量，与 该user 没有看过的 document 向量 之间的相似度
> 
> TF-IDF : 评估一个 word 对当前 document 的重要性。 当前升高而升高，所有doc中，升高而下降。

## 4. 策略层

### 4.1 page 分类

内容兴趣二级分类，大部分类可以支持到二级分类，返回二级类目的id；部分类：读书、游戏等，只支持到一级分类，返回一级类目的id。
  
类别权重用模型预测时返回的分数表示，不做加和为1的归一化处理。

### 4.2 用户兴趣计算

假设用户 $u$ 某一天访问的页面集合 $D = \lbrace d\_i \rbrace, i = 1..m$ , 页面 $d\_i$ 的类别概率分布是 $P\_i = \lbrace p\_{ij} \rbrace, j = 1..k$
 
那么，$u$ 在某个兴趣类别 $c$ 上的分数:

$$
score(u, c) = log(\sum\_{i=1}^m I (p\_{ic} > 0.2) * \sum\_{i=1}^m p\_{ic} * {Count}\_{ui})
$$

其中$I (p\_{ic} > 0.2)$是指示函数，当 $p\_{ic} > 0.2$ 时为 1，否则为 0。

公式说明， 影响分数的因素有两个：

1. 访问某一类别页面的个数，由前面的对数系数表示。
2. 页面在该类别上的概率，由后面的概率求和表示。

### 4.3 兴趣合并

#### 短期兴趣

假设用户的历史兴趣集合为 $\lbrace (c\_i, t\_i) \rbrace, i = 1\ to\ m$

$m$ 是兴趣总数，$c\_i$ 是第$i$个兴趣，$t\_i$ 是第$i$个兴趣的生成时间，用距离今天的天数表示。

对 $c\_i$ 按照时间衰减：${c\_i}^{'} = c\_i * a^{t\_{i}}$，$a$ 是衰减因子，取值 0.8，30天衰减到初始值的 0.1% 左右。

最后，对兴趣数目进行控制，最多只保留 10 种兴趣。

#### 长期兴趣

长期兴趣指用户在较长一段时间(至少3个月)内表现出的兴趣倾向。
 
策略如下：

1. 每周进行一次用户兴趣的合并。
2. 对于最近3个月的用户兴趣记录，统计如下两个指标:

`兴趣的周出现比例`

计算公式：***occur_ratio*** = 出现的周数 / 总周数
如果 ***occur_ratio*** 小于阈值，则认为该兴趣非长期兴趣，过滤掉。阈值根据经验设定，默认设置为0.5。

`兴趣的出现间隔方差`
     
我们认为长期兴趣出现是呈现周期性的，用间隔方差表示。
计算方法：根据兴趣的周出现序列，得到相邻两次出现的间隔序列，然后计算该序列的方差。举例：假设兴趣在第1、3、5、8、9、12周出现，计算出的间隔序列是：[2, 2, 3, 1, 3]，方差是0.56。

如果间隔方差大于阈值，认为兴趣属于临时兴趣，非长期兴趣。

---

由于cookie容易被用户清理掉，生命周期较短，我们采用跨屏打通提供的新浪统一id对用户的长期行为进行跟踪。

#### 兴趣归一化

对分数进行加和 和 归一化， 得到用户的兴趣类别概率:

$$
p(u, c) = \frac {score(u, c)} {\sum_{i=1}^k score(u, i)}
$$


## 4. 技术点
 
 - 词向量 Word2Vec
 - log 访问次数的平滑处理
 - 时间衰减 & 间隔方差判断长期兴趣


## next ⋯⋯

> notes：next ...

[img1]: /images/resume_project/user_interest_img.png