---
title: DataWare Business Review 3
toc: true
date: 2021-01-22 09:07:21
categories: [data-warehouse]
tags: [SQL]
---

<img src="/images/dataware/sm-data-warehouse-logo-1.jpg" width="580" alt="" />

<!-- more -->

**事件主题** - 还款流水, 授信流水, 支用流水, 放款流水, 还款计划. 在后端资产的模块.  

**DWD - 这些流水表都在这层.** 

(1). 授信支用后，就会产生借据号

> 个贷业务数据，包括申请ID，机构代号，贷款合同编号，担保类型，贷款期限，贷款起期，贷款止期，诉讼标志，逾期利息利率，还款帐号，终审金额，贷款金额，贷款余额，经办人编号，结清日期，还款方式，客户姓名，客户种类，客户性质，客户分类，证件类型，证件号码，流水号，借据号，借据金额，借据余额，借据利息余额，借据利率，借据起期，借据止期，借款状态，逾期天数，结息方式，放款账号，放款账户户名用途详情，还款账户户名，还款账户账号等。

## 8大主题模型

No. | 主题名称 | 主题描述
--- | --- | --- 
1. | **客户 (USER)** | 当事人, 用户信息, 非常多, 人行征信信息， 个人资产信息
2. | 机构 (ORG) | 线下有哪些团队, 浙江区，团队长，客户经理， 有 600+ 个. 只有维度表
<br>3. | <br>产品 (PRD) | 签协议 产生 产品, 业务流程, 只有维度表 <br> 产品维度表： 产品编号(分好几级), 产品名称, dim_code, dim_name， 上架， 下架<br>京东金条， code， 展示给财务
4. | 渠道 (CHL) |
5. | **事件 (EVT)** | 1. 同业借款(50~200亿) 2. 客户授信 3. 支用 4. 放款 5. 还款 6..
6. | **协议 (AGR)** | 合约
7. | 营销 (CAMP) |
8. | **财务 (RISK)** |
9. | 风险 (FINANCE) | 风险部

营销之后的，商务经理和渠道，谈下来之后， 后端 渠道， 资产， 账务


ODS 还款流水表：

还款流水号 | 借据号 | 还款日 | 还款金额 | 还款金额(本金，利息，手续费), | user\_id | product\_id | ...
:---: | --- | --- | --- | --- | --- | --- | ---

> 还款流水 （平均日增40~50W， 偶尔100~200W也是有的）, 年上亿

ODS 冲正还款流水表（1W内）：

还款流水号 | 借据号 | 还款日 | 还款金额 | 还款金额(本金，利息，手续费), | user\_id | product\_id | ...
:---: | --- | --- | --- | --- | --- | --- | ---

DWD： 还款事实表 (Join from 还款流水表 & 冲正还款流水表)

> 还款事实表 - 借据号(可以关联到用户和产品), 还款流水号, 还款金额(本金，利息，手续费), user\_id, product\_id, custom\_id
>
> 下游可能看，借据粒度，还了多少钱， 聚合
>
> 每天拉昨天新增的流水

DWS：按照借据号 Group, 借据号是最小的粒度了.


> 数据量很大，但是这里有一个小技巧: 金额加上去.  

> 1. SQL
> 2. Data Skew
> 3. DW Model

> table name: 主题域\_dwd\_table

<details>
<summary>EVT Topic</summary>

授信流水, 几十万，上百万
支用流水, 
放款流水, 
还款流水, 日增 几十万 ~ 百万， 利用sqoop抽取新增

一天放款上亿，回收也是上亿

客户 4000W / 拮据 800W

> 360: 300W+
> 分期乐： 200W+
> 借呗： 100W+
> 尊享贷： 10W+
> JD： 50W+
> 百度，翼支付，小米，滴滴

不同渠道，产品，利率段
放款金额，不同区间的，用户数
</details>

## Reference

- [浅谈银行数据仓库：金融主题层建设篇](https://www.infoq.cn/article/gsmwfqq7kjsg0k9adwqr)
- [数据仓库-建模实践](https://www.bilibili.com/video/BV1Cz4y1k7y4/?spm_id_from=333.788.videocard.0)
- [独一无二的数据仓库建模指南（升级版）](https://www.bilibili.com/video/av45576201/)
- [大数据项目之离线数仓2.0项目实战教程](https://www.bilibili.com/video/BV1t54y1r7Mc?p=156)